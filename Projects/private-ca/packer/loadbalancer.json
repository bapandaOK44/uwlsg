{
    "variables": {
      "consul_version": "1.2.1"
    },
  
    "builders": [
      {
        "snapshot_name": "loadbalancer",
        "type": "digitalocean",
        "image": 36719599,
        "size": "s-2vcpu-2gb",
        "region": "sfo1",
        "ssh_username": "root"
      }
    ],
  
    "provisioners": [
      {
        "type": "file",
        "source": "hashicorp.asc",
        "destination": "/tmp/hashicorp.asc"
      },
      {
        "type": "shell",
        "inline": [
          "gpg --import /tmp/hashicorp.asc",
          "apt update -yq",
          "apt install -y haproxy unzip jq build-essential ruby ruby-dev",
          "gem install --no-rdoc --no-ri inspec",
          "DEBIAN_FRONTEND=noninteractive apt upgrade -yq",
          "curl -Os https://releases.hashicorp.com/consul/{{ user `consul_version` }}/consul_{{ user `consul_version` }}_SHA256SUMS",
          "curl -Os https://releases.hashicorp.com/consul/{{ user `consul_version` }}/consul_{{ user `consul_version` }}_SHA256SUMS.sig",
          "curl -Os https://releases.hashicorp.com/consul/{{ user `consul_version` }}/consul_{{ user `consul_version` }}_linux_amd64.zip",
          "gpg --verify consul_{{ user `consul_version` }}_SHA256SUMS.sig consul_{{ user `consul_version` }}_SHA256SUMS",
          "sha256sum --check --ignore-missing consul_{{ user `consul_version` }}_SHA256SUMS",
          "unzip -qq consul_{{ user `consul_version` }}_linux_amd64.zip -d /usr/bin",
          "mkdir -p /etc/consul",
          "mkdir -p /etc/inspec",
          "consul version",
          "inspec version",
          "sync"
        ]
      }
    ]
  }
  